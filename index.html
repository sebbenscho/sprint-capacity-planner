<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprint Capacity Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and base styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f7f7f9; /* Light background */
            /* Removed external margin/padding from body */
            padding: 0;
            margin: 0;
        }
        /* Custom styling for read-only fields (Results) */
        .result-field {
            background-color: #f0f4f8; 
            border: 1px solid #e2e8f0;
        }
        /* Highlight styling for the final result */
        .highlight-field {
            background-color: #4f46e5; /* Indigo */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4), 0 2px 4px -2px rgba(79, 70, 229, 0.4);
        }
    </style>
</head>
<!-- Removed external padding from body class -->
<body class="min-h-screen flex items-start justify-center">

    <!-- Hauptcontainer: p-1 auf p-0 reduziert, um an den Rand zu gehen -->
    <div class="w-full bg-white p-0">
        
        <!-- Header: Padding und Textgröße stark reduziert -->
        <div class="flex items-center mx-1 mb-1 border-b pb-0.5">
            <h1 class="text-lg font-extrabold text-gray-800 tracking-tight">Sprint Capacity Planner</h1>
        </div>

        <!-- Layout: Vertikaler Abstand auf gap-y-1 reduziert -->
        <div class="grid grid-cols-1 gap-y-1">
            
            <!-- INPUT SECTION: Inneres Padding auf p-1 reduziert -->
            <div id="input-section" class="p-1 bg-gray-50 rounded-lg border border-gray-100 mx-1">
                <h2 class="text-sm font-bold text-gray-700 mb-1 border-b pb-0.5">Variables (Editable)</h2>
                
                <div class="grid grid-cols-2 gap-2">
                    
                    <!-- Working hours per week (Half Width) -->
                    <div class="flex flex-col">
                        <label for="inputHoursPerWeek" class="text-xs font-medium text-gray-700 mb-0">Hours/Week</label>
                        <input type="number" id="inputHoursPerWeek" value="38.5" step="0.1" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                    </div>
                    
                    <!-- Weeks per sprint (Half Width) -->
                    <div class="flex flex-col">
                        <label for="inputWeeksPerSprint" class="text-xs font-medium text-gray-700 mb-0">Weeks/Sprint</label>
                        <input type="number" id="inputWeeksPerSprint" value="2" step="0.1" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                    </div>
                    
                    <!-- People working in sprint (Half Width) -->
                    <div class="flex flex-col">
                        <label for="inputPeopleWorking" class="text-xs font-medium text-gray-700 mb-0">People in Sprint</label>
                        <input type="number" id="inputPeopleWorking" value="5" step="1" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                    </div>

                    <!-- Working hours per day (Half Width) -->
                    <div class="flex flex-col">
                        <label for="inputHoursPerDay" class="text-xs font-medium text-gray-700 mb-0">Hours/Day</label>
                        <input type="number" id="inputHoursPerDay" value="7.7" step="0.1" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                    </div>

                    <!-- --- Separator for secondary variables --- -->
                    <div class="col-span-2 pt-1 border-t border-gray-200 mt-1 grid grid-cols-2 gap-2">
                        
                        <!-- Total absence days (Half Width) -->
                        <div class="flex flex-col">
                            <label for="inputAbsenceDays" class="text-xs font-medium text-gray-700 mb-0">Absence Days</label>
                            <input type="number" id="inputAbsenceDays" value="5" step="0.5" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                        </div>
                        
                        <!-- Buffer (%) (Half Width) -->
                        <div class="flex flex-col">
                            <label for="inputBuffer" class="text-xs font-medium text-gray-700 mb-0">Buffer (%)</label>
                            <input type="number" id="inputBuffer" value="20" step="1" min="0" max="100" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                        </div>
                        
                        <!-- Rolling AVG SPs (Full Width) - MOVED TO BOTTOM -->
                        <div class="flex flex-col col-span-2 mt-1">
                            <label for="inputRollingSPs" class="text-xs font-medium text-gray-700 mb-0">Rolling AVG SPs (Past Velocity)</label>
                            <input type="number" id="inputRollingSPs" value="22.29" step="0.01" class="w-full px-1.5 py-0.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150">
                        </div>
                    </div>
                </div>
            </div>

            <!-- RESULTS SECTION: Vertikaler Abstand auf space-y-1 reduziert -->
            <div id="results-section" class="space-y-1 mx-1">
                <h2 class="text-sm font-bold text-gray-700 mb-1 border-b pb-0.5">Results (Protected)</h2>
                
                <!-- Grid für Zwischenergebnisse: Spaltenabstand reduziert -->
                <div class="grid grid-cols-2 gap-2">
                    
                    <!-- BASE CAPACITY METRICS: Padding in Ergebnis-Feldern auf p-1 reduziert -->
                    <div class="p-1 rounded-lg result-field">
                        <div class="text-xs text-gray-500">Hours/Sprint</div>
                        <div id="outputHoursPerSprint" class="text-sm font-bold tracking-tight text-gray-800"></div>
                    </div>
    
                    <div class="p-1 rounded-lg result-field">
                        <div class="text-xs text-gray-500">100% Capacity</div>
                        <div id="outputHoursOf100Capacity" class="text-sm font-bold tracking-tight text-gray-800"></div>
                    </div>
                    
                    <!-- SEPARATOR LINE HERE: Margin reduziert -->
                    <div class="col-span-2 border-t border-gray-300 mt-1 mb-1"></div>
                    <!-- END SEPARATOR LINE -->

                    <!-- ADJUSTED CAPACITY METRICS: Padding in Ergebnis-Feldern auf p-1 reduziert -->
                    <div class="p-1 rounded-lg result-field">
                        <div class="text-xs text-gray-500">Absence (hrs)</div>
                        <div id="outputHoursOfAbsence" class="text-sm font-bold tracking-tight text-gray-800"></div>
                    </div>
                    
                    <div class="p-1 rounded-lg result-field">
                        <div class="text-xs text-gray-500">Actual Hours</div>
                        <div id="outputActualHoursPerSprint" class="text-sm font-bold tracking-tight text-gray-800"></div>
                    </div>
                    
                    <div class="p-1 rounded-lg result-field">
                        <div class="text-xs text-gray-500">Act. Capacity %</div>
                        <div id="outputCapacityExcludingAbsences" class="text-sm font-bold tracking-tight text-gray-800"></div>
                    </div>
                    
                    <div class="p-1 rounded-lg result-field">
                        <div class="text-xs text-gray-500">SP Capacity %</div>
                        <div id="outputBufferSubstracted" class="text-sm font-bold tracking-tight text-gray-800"></div>
                    </div>
                </div>
                
                <!-- Endergebnis (Highlight): Padding und Textgröße reduziert -->
                <div class="p-2 rounded-lg highlight-field mt-1 mb-1">
                    <div class="text-xs text-indigo-200">Actual SPs per sprint</div>
                    <div id="outputActualSPsPerSprint" class="text-lg font-extrabold tracking-tight text-white"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Helper function to safely parse string state to float, defaulting to 0
        const safeParseFloat = (id) => {
            const element = document.getElementById(id);
            const parsed = parseFloat(element.value);
            return isNaN(parsed) ? 0 : parsed;
        };

        const safeDivide = (numerator, denominator) => {
            return denominator === 0 ? 0 : numerator / denominator;
        };

        function calculateCapacity() {
            // --- 1. Get Inputs (IDs match the HTML fields) ---
            const rSPs = safeParseFloat('inputRollingSPs');
            const wHPW = safeParseFloat('inputHoursPerWeek');
            const wPS = safeParseFloat('inputWeeksPerSprint');
            const pW = safeParseFloat('inputPeopleWorking');
            const wHPD = safeParseFloat('inputHoursPerDay');
            const aD = safeParseFloat('inputAbsenceDays');
            const b = safeParseFloat('inputBuffer');

            // --- 2. Calculations (Updated Logic for SP Capacity %) ---
            
            // 1. Hours per sprint (Total team hours per sprint)
            const hoursPerSprint = wHPW * wPS;
            
            // 2. Hours of 100% capacity
            const hoursOf100Capacity = hoursPerSprint * pW;
            
            // 3. Hours of absence total
            const hoursOfAbsence = aD * wHPD;
            
            // 4. Actual hours per sprint (Capacity - Absence)
            const actualHoursPerSprint = hoursOf100Capacity - hoursOfAbsence;
            
            // 5. Actual Capacity % (Capacity excluding absences)
            const capacityExcludingAbsences = safeDivide(actualHoursPerSprint, hoursOf100Capacity) * 100;

            // 6. Buffer multiplier (e.g., 1 - 0.20 = 0.80)
            const bufferMultiplier = safeDivide((100 - b), 100);
            
            // 7. SP Capacity % (Actual Capacity % * Buffer Multiplier)
            const spCapacityPercentage = capacityExcludingAbsences * bufferMultiplier;

            // 8. Actual SPs per sprint (The estimated outcome)
            // Uses the newly calculated SP Capacity % directly
            const actualSPsPerSprint = rSPs * safeDivide(spCapacityPercentage, 100);

            // --- 3. Update Results in UI ---
            document.getElementById('outputHoursPerSprint').textContent = hoursPerSprint.toFixed(2) + ' hrs';
            document.getElementById('outputHoursOf100Capacity').textContent = hoursOf100Capacity.toFixed(2) + ' hrs';
            document.getElementById('outputHoursOfAbsence').textContent = hoursOfAbsence.toFixed(2) + ' hrs';
            document.getElementById('outputActualHoursPerSprint').textContent = actualHoursPerSprint.toFixed(2) + ' hrs';
            
            // Actual Capacity %
            document.getElementById('outputCapacityExcludingAbsences').textContent = capacityExcludingAbsences.toFixed(2) + '%';
            
            // SP Capacity % (Now calculated as Actual Capacity * (1 - Buffer))
            document.getElementById('outputBufferSubstracted').textContent = spCapacityPercentage.toFixed(2) + '%';
            
            // Actual SPs per sprint (Using the new SP Capacity %)
            document.getElementById('outputActualSPsPerSprint').textContent = actualSPsPerSprint.toFixed(2);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const inputElements = document.querySelectorAll('#input-section input');
            
            // Attach the calculation function to every input event
            inputElements.forEach(input => {
                input.addEventListener('input', calculateCapacity);
            });

            // Run initial calculation when the page loads
            calculateCapacity();
        });
    </script>
</body>
</html>
